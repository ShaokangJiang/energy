<!DOCTYPE html>
<html lang="en">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0" />
    <title>Energy -- setting
        <!--{cn}能量 -- 设置-->
    </title>

    <!-- CSS  -->
    <link href="css/icon.css" rel="stylesheet">
    <link href="css/materialize.css" type="text/css" rel="stylesheet" media="screen,projection" />
    <link href="css/style.css" type="text/css" rel="stylesheet" media="screen,projection" />
    <script src="./js/solver.js"></script>
    <script src="./js/jquery-2.1.1.min.js"></script>
    <script src="./js/translater.min.js"></script>
    <script src="./js/papaparse.min.js"></script>
</head>

<body>

    <nav class="Maroon" role="navigation">
        <div class="nav-wrapper container"><a id="logo-container" href="#" class="brand-logo">Logo</a>

            <ul class="right hide-on-med-and-down">
                <li id="nav-cn"><a href="javascript:;" onclick="tran.setLang('cn');document.getElementById('nav-en').className = '';document.getElementById('nav-en-m').className = '';document.getElementById('nav-cn-m').className = 'active';document.getElementById('nav-cn').className = 'active';">中文</a></li>
                <li id="nav-en" class="active"><a href="javascript:;" onclick="tran.setLang('default');document.getElementById('nav-en').className = 'active';document.getElementById('nav-en-m').className = 'active';document.getElementById('nav-cn').className = '';document.getElementById('nav-cn-m').className = '';">EN</a></li>
            </ul>

            <ul id="nav-mobile" class="sidenav">
                <li id="nav-cn-m"><a href="javascript:;" onclick="tran.setLang('cn');document.getElementById('nav-en').className = '';document.getElementById('nav-en-m').className = '';document.getElementById('nav-cn-m').className = 'active';document.getElementById('nav-cn').className = 'active';">中文</a></li>
                <li id="nav-en-m" class="active"><a href="javascript:;" onclick="tran.setLang('default');document.getElementById('nav-en').className = 'active';document.getElementById('nav-en-m').className = 'active';document.getElementById('nav-cn').className = '';document.getElementById('nav-cn-m').className = '';">EN</a></li>
            </ul>
            <a href="#" data-target="nav-mobile" class="sidenav-trigger"><i class="material-icons">translate</i></a>

        </div>
    </nav>

    <br><br>


    <div class="row">
        <div class="col s0 m0 l1">
        </div>


        <div class="col s12 m12 l5">
            <div class="card white z-depth-3">
                <div class="card-content black-text">
                    <span class="card-title">General Introduction<!--{cn}总体介绍--></span>
                    <p>Welcome to this combination energy tool.
                        <!--{cn}欢迎使用这个组合能量工具。-->
                    </p>
                    <p>Data file input will be shown once you set up threshold setting.
                        <!--{cn}一旦设置了阈值设置，将显示数据文件输入。--><span id="Speed_text"></span></p>
                    <!--General inro, including equation, description, usage -->

                    <h5>Usage
                        <!--{cn}用法-->
                    </h5>

                    <h5>Method
                        <!--{cn}方法-->
                    </h5>
                    <h5>Intro
                        <!--{cn}介绍-->
                    </h5>
                    <p>Check README on
                        <!--{cn}查看--><a href="https://github.com/ShaokangJiang/energy">Github</a> about fake data file generation and other detailed perspective.
                        <!--{cn}上的自述文件，了解假数据文件生成和其他详细的透视图。-->
                    </p>
                    <h5>ChangeLog
                        <!--{cn}变更日志-->
                    </h5>
                    <ol>
                        <li>5/25/2020 Core running function finished & Time field in input simulation file is not required
                            <!--{cn}2020.5.25 核心运行功能完成，输入模拟文件中不需要时间字段-->
                        </li>
                        <li>5/26/2020 Multi-language added
                            <!--{cn}2020.5.26 新增多语言-->
                        </li>
                        <li>5/27/2020 Optimize font and icon loading
                            <!--{cn}2020.5.27 优化字体和图标加载-->
                        </li>
                        <li>5/29/2020 Optimization to find best history result function added
                            <!--{cn}2020.5.29 添加最佳历史结果函数的优化-->
                        </li>
                    </ol>
                </div>
            </div>
        </div>

        <div class="col s12 m12 l5">
            <div class="card white z-depth-3">
                <div class="card-content black-text">
                    <span class="card-title">Threshold Setting<!--{cn}阈值调整--></span>
                    <p>Adjust setting as you want. Two types are provided.
                        <!--{cn}根据需要调整设置。提供两种类型。-->
                    </p>
                    <span id="notification"></span>
                </div>
                <div class="card-action">

                    <form id="login" name="login" method="GET" action="run.html" onsubmit="return checkForm()">
                        <div class="row">
                            <p>
                                <label>
                              <input class="with-gap" id="radio1" name="group1" type="radio" value="1" onclick="select1()"/>
                              <span>Manual Set Threshold<!--{cn}手动设定阈值--></span>
                            </label>
                            </p>


                            <div class="input-field col s6">
                                <input disabled id="wind" name="wind" type="text" class="validate" onkeyup="this.value=this.value.replace(/[^\d]/g,'') " onafterpaste="this.value=this.value.replace(/[^\d]/g,'') ">
                                <label for="wind">Wind(mph)<!--{cn}风速(每小时英里)--></label>
                            </div>
                            <div class="input-field col s6">
                                <input disabled id="light" name="light" type="text" class="validate" onkeyup="this.value=this.value.replace(/[^\d]/g,'') " onafterpaste="this.value=this.value.replace(/[^\d]/g,'') ">
                                <label for="light">Light(LUX)<!--{cn}光(流明)--></label>
                            </div>
                            <div class="input-field col s6">
                                <input disabled id="wave" name="wave" type="text" class="validate" onkeyup="this.value=this.value.replace(/[^\d]/g,'') " onafterpaste="this.value=this.value.replace(/[^\d]/g,'') ">
                                <label for="wave">Wave<!--{cn}波浪--></label>
                            </div>
                            <div class="input-field col s6">
                                <input disabled id="current" name="current" type="text" class="validate" onkeyup="this.value=this.value.replace(/[^\d]/g,'') " onafterpaste="this.value=this.value.replace(/[^\d]/g,'') ">
                                <label for="current">Ocean Current<!--{cn}洋流--></label>
                            </div>

                            <div class="input-field col s6">
                                <input disabled id="battery" name="battery" type="text" class="validate" onkeyup="this.value=this.value.replace(/[^\d]/g,'') " onafterpaste="this.value=this.value.replace(/[^\d]/g,'') ">
                                <label for="battery">Battery capacity(KWH)<!--{cn}电池容量(千瓦时)--></label>
                            </div>

                            <div class="input-field col s6">
                                <input disabled id="freq" name="freq" type="text" class="validate" onkeyup="this.value=this.value.replace(/[^\d]/g,'') " onafterpaste="this.value=this.value.replace(/[^\d]/g,'') ">
                                <label for="freq">Refresh Frequency(ms)<!--{cn}刷新频率(毫秒)--></label>
                            </div>
                            <p class="col s6"><label>
                                <input class="with-gap" id="radio2" name="group1" type="radio" checked value="2" onclick="select2()"/>
                                <span>Use History Data<!--{cn}使用历史数据--></span>
                              </label>
                            </p>
                            <div class="input-field col s6">
                                <input id="User" name="User" type="text" class="validate" onkeyup="this.value=this.value.replace(/[^\d]/g,'') " onafterpaste="this.value=this.value.replace(/[^\d]/g,'') ">
                                <label for="User">User Usage(kwh/day)<!--{cn}使用量(千瓦时/天)--></label>
                            </div>

                            <div class="file-field input-field col s6">

                                <div class="btn">
                                    <span>File</span>
                                    <input id="history_data" name="history_data" type="file" accept=".csv,text/csv" onchange="loadFile(this)">
                                </div>
                                <div class="file-path-wrapper">
                                    <input placeholder="History data" placeholder-cn="历史数据" id="hist_data" class="file-path validate" type="text">
                                </div>
                            </div>


                            <p class="col s6"><label>
                                    <input type="checkbox" onchange="userUsageSwitch(this);" />
                                    <span>I will provide user data in input file in the next page<!--{cn}我将在下一页的输入文件中提供用户数据--></span>
                                  </label></p>






                            <p class="col s9"></p>
                            <button class="btn waves-effect waves-light col s3" type="submit" name="action">Submit<!--{cn}提交-->
                      
                      
                            <i class="material-icons right">send</i>
                    </button>

                        </div>
                    </form>
                </div>
            </div>
        </div>

        <div class="col s0 m0 l1">
        </div>

    </div>

    <br><br>
    </div>

    <footer class="page-footer orange">
        <div class="container">
            <div class="row">
                <h5 class="white-text">Info
                    <!--{cn}信息-->
                </h5>
                <p class="grey-text text-lighten-4">efe</p>



            </div>
            <div class="footer-copyright">
                <div class="container">
                    Made by
                    <!--{cn}由--><a class="orange-text text-lighten-3" href="https://shaokang.ga">Shaokang Jiang</a> using
                    <!--{cn}使用--><a class="orange-text text-lighten-3" href="http://materializecss.com">Materialize<!--{cn}Materialize 主题制作--></a>
                </div>
            </div>
    </footer>


    <!--  Scripts-->

    <script src="js/materialize.js"></script>
    <script>
        M.AutoInit();

        var file;

        function loadFile(use) {
            if (use.files[0] != null && use.files[0].name.indexOf(".csv") != -1)
                file = use.files[0];
            else {
                use.value = '';
                if (tran.getLang() == 'cn') document.getElementById("notification").innerHTML = '<font color="red">请选择一个csv文件</font>';

                else document.getElementById("notification").innerHTML = '<font color="red">Please select a csv file. </font>';

            }
        }

        function userUsageSwitch(use) {
            if (use.checked) {
                document.getElementById("User").disabled = true;
            } else {

                document.getElementById("User").disabled = false;
            }
        }

        function checkForm() {
            if (checkFormValid()) {
                return false;
            } else {
                location.href = "run.html";
            }
            return true;
        }

        function checkFormValid() {
            if (document.getElementById("radio1").checked == true) {
                if (document.getElementById("wind").value == "" ||
                    document.getElementById("light").value == "" || document.getElementById("wave").value == "" ||
                    document.getElementById("current").value == "" || document.getElementById("battery").value == "" ||
                    document.getElementById("freq").value == "" || (document.getElementById("User").disabled == false && document.getElementById("User").value == "")) {
                    if (tran.getLang() == 'cn') document.getElementById("notification").innerHTML = '<font color="red">您需要填写所有空字段。</font>';

                    else
                        document.getElementById("notification").innerHTML = '<font color="red">You need to fill all empty fields. </font>';

                    return true;
                };
                return false;
            }
            if (document.getElementById("radio2").checked == true) {
                if ((document.getElementById("User").disabled == false && document.getElementById("User").value == "") ||
                    document.getElementById("hist_data").value == "" || document.getElementById("history_data").value == "") {
                    if (tran.getLang() == 'cn') document.getElementById("notification").innerHTML = '<font color="red">您需要填写所有空字段。</font>';

                    else
                        document.getElementById("notification").innerHTML = '<font color="red">You need to fill all empty fields. </font>';
                    return true;
                };
                /** TODO
                //solve some optimization problem at here
                var days = 0;
                var model = {};
                model["optimize"] = "days";
                model["opType"] = "min";
                model["constraints"] = {};
                model["variables"] = {};
                Papa.parse(file, {
                    header: true,
                    skipEmptyLines: true,
                    dynamicTyping: true,
                    step: function(results, parser) {
                        console.log("Row data:", results.data);
                        //analyze data at here
                        //use == " " || == null to check empty
                        days += results.data["wind_count"]
                    },
                    complete: function(results, parser) {

                    }
                });
                model["constraints"] = {};
                */
                return true;
            }

            return true;
        }

        /**
        *sample model
                optimization({
                    "optimize": "count",
                    "opType": "min",
                    "constraints": {
                        "value": {
                            "min": 300
                        },
                        "labor": {
                            "max": 110
                        },
                        "storage": {
                            "max": 400
                        },
                        "table": {
                            "min": 10
                        }
                    },
                    "variables": {
                        "a01": {
                            "value": 30,
                            "count": 5,
                            "a01": 1
                        },
                        "dresser": {
                            "wood": 20,
                            "labor": 10,
                            "profit": 1600,
                            "dresser": 1,
                            "storage": 50
                        }
                    },
                    "ints": {
                        "a01": 1,
                        "dresser": 1
                    }
                });*/


        function select2() {

            document.getElementById("wind").disabled = true;
            document.getElementById("light").disabled = true;
            document.getElementById("wave").disabled = true;
            document.getElementById("current").disabled = true;
            document.getElementById("battery").disabled = true;
            document.getElementById("freq").disabled = true;

            document.getElementById("hist_data").disabled = false;
            document.getElementById("history_data").disabled = false;

        }

        function select1() {
            document.getElementById("wind").disabled = false;
            document.getElementById("light").disabled = false;
            document.getElementById("wave").disabled = false;
            document.getElementById("current").disabled = false;
            document.getElementById("battery").disabled = false;
            document.getElementById("freq").disabled = false;
            document.getElementById("hist_data").disabled = true;
            document.getElementById("history_data").disabled = true;
        }

        //1-wind 2-light 3-wave 4-current
        function optimization(model) {
            var results;

            results = solver.Solve(model);
            console.log(results);
            //document.getElementById("Speed_text").innerText = "feasible:" + results.feasible + ", result: " + results.result + ", bounded: " + results.bounded + ", brit: " + results.brit + ", yank: " + results.yank;
        }

        var tran;

        var lang = navigator.language || navigator.browserLanguage;
        if (/^zh/.test(lang)) {
            //alert('中文');
            tran = new Translater({
                lang: "cn"
            });
            document.getElementById('nav-en').className = '';
            document.getElementById('nav-cn').className = 'active';
            document.getElementById('nav-en-m').className = '';
            document.getElementById('nav-cn-m').className = 'active';
        } else {
            //alert('不是中文');
            tran = new Translater({
                lang: "en"
            });
        }
    </script>

</body>

</html>